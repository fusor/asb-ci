---
  - name: Set hostname
    hostname:
      name: "{{ inventory_hostname }}"

  - name: Create jenkins repo
    yum_repository:
      name: "jenkins"
      description: "Jenkins Stable Repo"
      baseurl: "http://pkg.jenkins.io/redhat-stable"
      enabled: yes
      gpgcheck: yes
      gpgkey: http://pkg.jenkins-ci.org/redhat-stable/jenkins-ci.org.key

  - name: Update packages
    yum:
      name: '*'
      state: latest

  - name: Install packages
    yum:
      name: java-1.8.0-openjdk
      state: latest

  - name: Start firewalld
    systemd:
      name: firewalld
      enabled: yes
      state: started

  - name: Get swarm client
    get_url:
      url: "https://repo.jenkins-ci.org/releases/org/jenkins-ci/plugins/swarm-client/3.4/swarm-client-3.4.jar"
      dest: /opt/swarm-client.jar
      mode: 0755

  - name: Create swarm client service file
    copy:
      src: "{{ role_path }}/files/usr/lib/systemd/system/swarm-client.service"
      dest: /usr/lib/systemd/system/swarm-client.service

  - name: Start services 
    systemd:
      name: "{{ item }}"
      enabled: yes
      state: started
      daemon_reload: yes
    with_items:
    - firewalld
    - swarm-client
